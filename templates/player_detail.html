{% extends 'base.html' %}
{% block title %}{{ player.name }} | Player Details{% endblock %}
{% block content %}

<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="text-primary mb-0">{{ player.name }}</h2>
    {% if team %}
      <span class="badge bg-dark fs-6">{{ team.name }}</span>
    {% endif %}
  </div>

  <div class="row mb-4">
    <!-- Totals overview -->
    <div class="col-md-2 col-6 mb-3">
      <div class="card text-center shadow-sm">
        <div class="card-body">
          <h5 class="card-title text-secondary">Goals</h5>
          <h3 class="fw-bold text-success">{{ totals.goals }}</h3>
        </div>
      </div>
    </div>

    <div class="col-md-2 col-6 mb-3">
      <div class="card text-center shadow-sm">
        <div class="card-body">
          <h5 class="card-title text-secondary">Assists</h5>
          <h3 class="fw-bold text-info">{{ totals.assists }}</h3>
        </div>
      </div>
    </div>

    <div class="col-md-2 col-6 mb-3">
      <div class="card text-center shadow-sm">
        <div class="card-body">
          <h5 class="card-title text-secondary">Tackles</h5>
          <h3 class="fw-bold text-warning">{{ totals.tackles }}</h3>
        </div>
      </div>
    </div>

    <div class="col-md-3 col-6 mb-3">
      <div class="card text-center shadow-sm">
        <div class="card-body">
          <h5 class="card-title text-secondary">Passes</h5>
          <h3 class="fw-bold">{{ totals.passes_completed }}/{{ totals.passes_attempted }}</h3>
        </div>
      </div>
    </div>

    <div class="col-md-3 col-6 mb-3">
      <div class="card text-center shadow-sm">
        <div class="card-body">
          <h5 class="card-title text-secondary">Appearances</h5>
          <h3 class="fw-bold">{{ totals.appearances }}</h3>
        </div>
      </div>
    </div>
  </div>

  <!-- Performance table -->
  <div class="card shadow-sm">
    <div class="card-header bg-dark text-white fw-semibold">Match Performance History</div>
    <div class="card-body">
      {% if performances %}
      <table class="table table-striped table-hover align-middle">
        <thead class="table-secondary">
          <tr>
            <th>Date</th>
            <th>Goals</th>
            <th>Assists</th>
            <th>Passes (C/A)</th>
            <th>Accuracy %</th>
            <th>Tackles</th>
            <th>Rating</th>
          </tr>
        </thead>
        <tbody>
          {% for r in performances %}
          <tr>
            <td>{{ r.date }}</td>
            <td>{{ r.goals }}</td>
            <td>{{ r.assists }}</td>
            <td>{{ r.passes_completed }}/{{ r.passes_attempted }}</td>
            <td>{{ "%.1f"|format(r.pass_accuracy) }}</td>
            <td>{{ r.tackles }}</td>
            <td>
              <span class="badge bg-primary">{{ r.rating }}</span>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

      {% else %}
        <p class="text-muted mb-0">No performance data yet.</p>
      {% endif %}
    </div>
  </div>

  <!-- Chart -->
  <div class="mt-5">
    <h5 class="text-secondary mb-3">Rating Over Time</h5>
    <canvas id="playerChart" height="120"></canvas>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
fetch("{{ url_for('api_player_performance', player_id=player.id) }}")
  .then(res => res.json())
  .then(data => {
    const ctx = document.getElementById('playerChart');

    new Chart(ctx, {
      type: 'line',
      data: {
        labels: data.labels,
        datasets: [{
          label: 'Rating',
          data: data.values,
          borderWidth: 2,
          borderColor: 'rgba(54, 162, 235, 0.8)',
          fill: false,
          tension: 0.3
        }]
      },
      options: {
        scales: {
          y: { beginAtZero: true, max: 10 }
        }
      }
    });
  });
</script>

{% endblock %}
